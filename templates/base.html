<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Sistema Integral de Evaluación para el personal y procesos del IES RFA">
  <title>{% block title %}Sistema de Evaluación IES RFA{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
  <!-- Skip to main content for accessibility -->
  <a href="#main-content" class="sr-only sr-only-focusable focus:not-sr-only focus:absolute focus:p-3 focus:bg-blue-600 focus:text-white focus:z-50">
    Saltar al contenido principal
  </a>
  
  <!-- Flash messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="fixed top-4 right-4 z-50 space-y-2">
        {% for category, message in messages %}
          <div class="toast toast-{{ category if category else 'info' }} fade-in" 
               role="alert"
               aria-live="assertive"
               x-data="{ show: true }"
               x-show="show"
               x-init="setTimeout(() => show = false, 5000)">
            <div class="flex justify-between items-center">
              <div class="flex">
                {% if category == 'success' %}
                  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                {% elif category == 'error' %}
                  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                {% elif category == 'warning' %}
                  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                  </svg>
                {% else %}
                  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                {% endif %}
                <span>{{ message }}</span>
              </div>
              <button @click="show = false" class="ml-4 text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" aria-label="Cerrar notificación">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Header -->
  {% if current_user.is_authenticated %}
    <header class="bg-blue-800 text-white shadow-md">
      <div class="container mx-auto px-4 py-3">
        <div class="flex justify-between items-center">
          <div class="flex items-center space-x-2">
            <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="Logo IES RFA" class="h-8">
            <span class="text-xl font-semibold">Sistema de Evaluación</span>
          </div>
          <div class="flex items-center space-x-4">
            <div class="relative" x-data="{ isOpen: false }">
              <button @click="isOpen = !isOpen" class="flex items-center space-x-2 focus:outline-none focus:ring-2 focus:ring-blue-300 rounded p-1" aria-expanded="false">
                <div class="h-8 w-8 rounded-full bg-blue-600 flex items-center justify-center text-white">
                  {{ current_user.nombre[0] }}{{ current_user.apellido[0] }}
                </div>
                <span class="hidden md:inline-block">{{ current_user.full_name() }}</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div x-show="isOpen" @click.away="isOpen = false" class="absolute right-0 mt-2 py-2 w-48 bg-white rounded-md shadow-lg z-10">
                <a href="{{ url_for('dashboard.index') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Dashboard</a>
                <a href="{{ url_for('auth.change_password') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Cambiar contraseña</a>
                <div class="border-t border-gray-100"></div>
                <a href="{{ url_for('auth.logout') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Cerrar sesión</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main navigation -->
    <nav class="bg-blue-700 text-white shadow-md">
      <div class="container mx-auto px-4">
        <div class="flex space-x-1 overflow-x-auto">
          <a href="{{ url_for('dashboard.index') }}" class="nav-link {% if request.endpoint == 'dashboard.index' %}nav-link-active{% else %}nav-link-inactive{% endif %}">
            Dashboard
          </a>
          {% if user_has_permission('view_self_evaluation') %}
            <a href="{{ url_for('self_evaluation.index') }}" class="nav-link {% if request.endpoint.startswith('self_evaluation.') %}nav-link-active{% else %}nav-link-inactive{% endif %}">
              Autoevaluación
            </a>
          {% endif %}
          {% if user_has_permission('view_student_evaluation') %}
            <a href="{{ url_for('student_evaluation.index') }}" class="nav-link {% if request.endpoint.startswith('student_evaluation.') %}nav-link-active{% else %}nav-link-inactive{% endif %}">
              Evaluación a Docentes
            </a>
          {% endif %}
          {% if user_has_permission('view_incidents') %}
            <a href="{{ url_for('incidents.index') }}" class="nav-link {% if request.endpoint.startswith('incidents.') %}nav-link-active{% else %}nav-link-inactive{% endif %}">
              Incidencias
            </a>
          {% endif %}
          {% if user_has_permission('view_checklists') %}
            <a href="{{ url_for('checklists.index') }}" class="nav-link {% if request.endpoint.startswith('checklists.') %}nav-link-active{% else %}nav-link-inactive{% endif %}">
              Listas de Cotejo
            </a>
          {% endif %}
          {% if user_has_permission('view_validations') %}
            <a href="{{ url_for('validation.index') }}" class="nav-link {% if request.endpoint.startswith('validation.') %}nav-link-active{% else %}nav-link-inactive{% endif %}">
              Validaciones
            </a>
          {% endif %}
          {% if user_has_permission('view_results') %}
            <a href="{{ url_for('results.index') }}" class="nav-link {% if request.endpoint.startswith('results.') %}nav-link-active{% else %}nav-link-inactive{% endif %}">
              Resultados
            </a>
          {% endif %}
          {% if user_has_permission('admin_access') %}
            <a href="{{ url_for('admin.index') }}" class="nav-link {% if request.endpoint.startswith('admin.') %}nav-link-active{% else %}nav-link-inactive{% endif %}">
              Administración
            </a>
          {% endif %}
        </div>
      </div>
    </nav>
  {% endif %}

  <!-- Main content -->
  <main id="main-content" class="flex-grow">
    <div class="container mx-auto px-4 py-6">
      {% block content %}{% endblock %}
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white">
    <div class="container mx-auto px-4 py-6">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="text-center md:text-left mb-4 md:mb-0">
          <p>&copy; {{ current_year }} Instituto de Educación Superior RFA. Todos los derechos reservados.</p>
        </div>
        <div>
          <p class="text-sm text-gray-400">Sistema Integral de Evaluación v0.1.0</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Alpine.js for interactive components -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <!-- Chart.js for charts and graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Main JS -->
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  {% block scripts %}{% endblock %}
</body>
</html>